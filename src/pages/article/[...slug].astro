---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { SITE_NAME } from "../../constant";
import Section from "./_[...slug]/Section.astro";
import ArticleHeader from "./_[...slug]/ArticleHeader.astro";
import ArticleContent from "./_[...slug]/ArticleContent.astro";

export async function getStaticPaths() {
  const articles = await getCollection("article");
  return articles.map((article) => ({
    params: { slug: article.slug },
    props: { article },
  }));
}

const { article } = Astro.props;
---

<Layout>
  <Fragment slot="head">
    <title>{article.data.title} | {SITE_NAME}</title>
    <meta name="description" content={article.data.description} />
    <meta property="og:title" content={article.data.title} />
    <meta property="og:type" content="article" />
    <meta property="og:description" content={article.data.description} />
    <meta
      property="article:published_time"
      content={article.data.publishedAt.toISOString()}
    />
    <meta
      property="article:modified_time"
      content={article.data.modifiedAt.toISOString()}
    />
    <meta property="article:author" content="ciffelia" />
    {
      article.data.tags.map((tag) => (
        <meta property="article:tag" content={tag} />
      ))
    }
    <meta name="twitter:card" content="summary_large_image" />
    {!article.data.isPublished && <meta name="robots" content="noindex" />}
  </Fragment>
  <article class="flex flex-col gap-5">
    <Section>
      <ArticleHeader {article} />
    </Section>
    <Section>
      <ArticleContent {article} />
    </Section>
  </article>
</Layout>
